<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>4.&nbsp;Customization</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Trails Tutorial"><link rel="up" href="index.html" title="Trails Tutorial"><link rel="previous" href="ar01s03.html" title="3.&nbsp;Relationships"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">4.&nbsp;Customization</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s03.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;</td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e152"></a>4.&nbsp;Customization</h2></div></div><div></div></div><p>So far we've seen what Trails can do just based on our object model alone. Trails uses the approach of assuming as much as we possibly can, but lets us override those assumptions whenever we need to. Let's explore how we can customize our blogging application. In Trails, there are two basic ways we can customize.</p><p></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e158"></a>4.1.&nbsp;Customizing pages in Trails</h3></div></div><div></div></div><p>Right now, Trails uses Tapestry as it's web MVC framework, so all pages in Trails are Tapestry pages. <sup>[<a href="#ftn.footenote1">1</a>]</sup>There are 2 basic types of pages in Trails: pages which extend <tt class="classname">ListPage</tt> and pages which extend <tt class="classname">EditPage</tt>. Pages which extend ListPage display a list of objects of a given type, while those that extend <tt class="classname">EditPage</tt> allow a user to edit a selected instance.</p><p>Trails determines which specific page to use by first attempting to find a page for a specific class by calling <tt class="methodname">cycle.getPage()</tt> with the unqualified class name and appending List or Edit depending on whether a ListPage or EditPage is needed. If it fails to find a specific page for the given type, it will look for a page named DefaultList or DefaultEdit, respectively. A Trails application will always need these pages, and they are created automatically when you create a new Trails project.</p><p>So we can change the look and feel of an entire Trails application by editing these pages, which are in our <tt class="computeroutput"><tt class="filename">WEB-INF</tt></tt> directory. We can also make a page for a given Class. Let's check out how this works in our blogging application. The <span class="property">entry</span> property of our <tt class="classname">BlogEntry</tt> page is currently rendered as a text field. This isn't really appropriate, so let's change this. First let's create a page named BlogEntryEdit. The easiest way to do this is to copy <tt class="filename">DefaultEdit.page</tt> and <tt class="filename">DefaultEdit.html</tt> (both are in<tt class="filename"> WEB-INF</tt>) and rename them to <tt class="filename">BlogEntryEdit.page</tt> and <tt class="filename">BlogEntryEdit.html</tt>, respectively.</p><p>In this page we could add fields for each of our properties and have complete control over how they are presented. However, in this case all we really want to do is change the way the <span class="property">entry</span> property appears. Fortunately, in Trails, we can customize at the property level; we don't have to hard-code the presentation of all the other properties if all we want to change is one. Let's take a look at the <sup>[<a href="#ftn.footnote2">2</a>]</sup><tt class="filename">BlogEntry.html</tt> file:</p><pre class="programlisting">&lt;!-- generated by Spindle, http://spindle.sourceforge.net --&gt;

&lt;span jwcid="$content$"&gt;
&lt;body jwcid="@Body"&gt;
    &lt;div class="description" jwcid="@Insert" value="ognl:classDescriptor.shortDescription" /&gt;
    &lt;div jwcid="@Conditional" class="error" condition="ognl:delegate.hasErrors" element="div"&gt;
        Error: &lt;span jwcid="@Delegator" delegate="hognl:delegate.firstError" /&gt;
    &lt;/div&gt;
    &lt;form jwcid="@trails:ObjectForm" model="ognl:model" &gt;
        
	&lt;/form&gt;
    &lt;a href="#" jwcid="@trails:ListAllLink" typeName="ognl:model.class.name" /&gt;
    &lt;a href="#" jwcid="@PageLink" page="Home"&gt;Home&lt;/a&gt;
&lt;/body&gt;
&lt;/span&gt;</pre><p>Here we start to get a look at how Trails works under the covers. We see two of the Trails Tapestry components, ListAllLink and ObjectForm. ListAllLink simply provides a link to the list page for a given type. ObjectForm is responsible for providing an edit form for a given instance. The instance is passed in via the model parameter. By default, ObjectForm will render all the properties of a given object by making assumptions based on the type of each property.</p><p>However, the ObjectForm component will also let us override the rendering of a property when we so desire. We do this by providing a Tapestry Block component with the same name as the property we wish to override. Here is what this looks like for our entry property:</p><pre class="programlisting">    &lt;form jwcid="@trails:ObjectForm" model="ognl:model" &gt;
        &lt;div jwcid="entry@Block"&gt;
            &lt;tr&gt;
                &lt;td&gt;Entry: &lt;/td&gt;
                &lt;td&gt;&lt;input jwcid="@TextArea" value="ognl:model.entry" /&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/div&gt;
    &lt;/form&gt;</pre><p>It should be noted that the ObjectForm component renders the form inputs inside of a table, so when overriding it is necessary to provide the table row, including the label and the input, for the property you are overriding.</p><p>This should be all we need to do to cause our entry property to be rendered in a textarea. We could have used any Tapestry components we wish here, as we have complete control over the row that renders this property. To see our work in action, go run the <span><b class="command">redeploy</b></span> target yet again.</p><p><sup>[<a name="footenote1" href="#ftn.footenote1">1</a>]</sup></p><p><sup>[<a name="footnote2" href="#ftn.footnote2">2</a>]</sup></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e238"></a>4.2.&nbsp;Customizing using bean metadata</h3></div></div><div></div></div><p>Customizing at the page level is certainly very useful, but there are some cases where it may be more convenient to customize using metadata. Trails makes use of (some would say abuse of) the java bean specification to allow you to specify metadata that can be useful to Trails. Here is the metadata that Trails currently understand and how it is used.</p><div class="informaltable"><table border="1"><colgroup><col align="center" width="50%"><col width="50%"></colgroup><thead><tr><th align="center">Xdoclet bean tag</th><th align="center">Trails meaning</th></tr></thead><tbody><tr><td align="center">displayName</td><td>This will be used to render a label for a property</td></tr><tr><td align="center">shortDescription</td><td>Will display at the top of a type's edit page</td></tr><tr><td align="center">hidden</td><td>Will cause a field not to display</td></tr></tbody></table></div><p>There is a generate-beaninfos target as part of a build that will generate beaninfo classes where needed. This may seem somewhat in contradiction to the Trails philosophy of avoiding generated code, however what we are really generating is metadata classes we don't plan on modifying directly.</p><p></p></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.footenote1" href="#footenote1">1</a>] </sup>There is actually another type of page which we won't cover during this tutorial, and AddToCollection page. It is used for parent-child relationship collections to create and add a new child to a parent collection.</p></div><div class="footnote"><p><sup>[<a name="ftn.footnote2" href="#footnote2">2</a>] </sup>It's also worth pointing out that by adding this Block to the BlogEntryEdit page, we actually affect any Trails page that displays a BlogEntry object.  This is because the Trails components responsible for rendering objects in a form are smart enough to look for Blocks that are in the object's edit page.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s03.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;</td></tr><tr><td width="40%" align="left" valign="top">3.&nbsp;Relationships&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;</td></tr></table></div></body></html>